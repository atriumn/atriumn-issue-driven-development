name: Development Pipeline (Simple)

on:
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Run in test mode'
        required: false
        type: boolean
        default: true

jobs:
  validate-workflow:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout shared workflows
        uses: actions/checkout@v4
        
      - name: Install dependencies
        run: |
          sudo wget -qO /usr/local/bin/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64
          sudo chmod +x /usr/local/bin/yq
          sudo apt-get update && sudo apt-get install -y gh
          
      - name: Test validation scripts
        run: |
          echo "🧪 Testing validation scripts..."
          
          # Test that scripts are executable
          for script in scripts/*.sh; do
            if [ -x "$script" ]; then
              echo "✅ $script is executable"
            else
              echo "❌ $script is not executable"
              exit 1
            fi
          done
          
          # Test help output
          for script in scripts/validate-*.sh; do
            if "$script" --help | grep -q "Usage:"; then
              echo "✅ $script has help output"
            else
              echo "❌ $script missing help output"
              exit 1
            fi
          done
          
      - name: Test configuration loading
        run: |
          echo "📋 Testing configuration files..."
          
          # Test YAML syntax
          for config in configs/*.yml; do
            if yq eval '.' "$config" > /dev/null; then
              echo "✅ $config has valid YAML syntax"
            else
              echo "❌ $config has invalid YAML syntax"
              exit 1
            fi
          done
          
      - name: Run test suite
        run: |
          echo "🔬 Running validation script tests..."
          ./test/test-validation-scripts.sh all
          
      - name: Workflow validation complete
        run: |
          echo "✅ All workflow validations passed!"
          echo "📦 Repository is ready for pipeline deployment"